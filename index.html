<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Survey Flow Builder</title>
  <style>
    body {
      font-family: sans-serif;
    }

    #canvas {
      width: 100%;
      height: 600px;
      border: 1px solid #ccc;
      position: relative;
    }

    .node {
      width: 200px;
      padding: 10px;
      background: #fefefe;
      border: 1px solid #888;
      border-radius: 5px;
      position: absolute;
      cursor: move;
    }
  </style>
</head>

<body>

  <h2>Survey Flow Builder</h2>
  <button onclick="addNode()">âž• Add Question</button>
  <button onclick="exportFlow()">ðŸ“¤ Export JSON</button>
  <pre id="output"></pre>

  <div id="canvas"></div>

  <script src="https://cdn.jsdelivr.net/npm/jsplumb@2.15.6/dist/js/jsplumb.min.js"></script>
  <script>
    let jsPlumbInstance = jsPlumb.getInstance();
    let count = 0;
    const nodes = {};

    function addNode() {
      const id = `q${++count}`;
      const el = document.createElement("div");
      el.className = "node";
      el.id = id;
      el.style.top = `${100 + count * 30}px`;
      el.style.left = `${100 + count * 30}px`;
      el.innerHTML = `
    <strong>${id}</strong><br>
    <input placeholder="Question text"><br>
    <select>
      <option value="text">Text</option>
      <option value="choice">Choice</option>
    </select>
  `;
      document.getElementById("canvas").appendChild(el);
      jsPlumbInstance.draggable(el);
      jsPlumbInstance.makeSource(el, {
        filter: "strong",
        anchor: "Continuous",
        connector: ["Flowchart"],
        connectorStyle: {stroke: "#2c3e50", strokeWidth: 2},
        maxConnections: -1
      });
      jsPlumbInstance.makeTarget(el, {
        dropOptions: {hoverClass: "hover"},
        anchor: "Continuous"
      });

      nodes[id] = {text: "", type: "text", conditionals: []};
    }

    jsPlumbInstance.bind("connection", function (info) {
      const sourceId = info.sourceId;
      const targetId = info.targetId;
      const condition = prompt(`Set condition for ${sourceId} â†’ ${targetId}`, `answer == "Yes"`);

      if (!condition) return;

      nodes[sourceId].conditionals.push({expression: condition, next: targetId});
    });

    function exportFlow() {
      // collect question text and type
      for (const id in nodes) {
        const el = document.getElementById(id);
        const inputs = el.getElementsByTagName("input");
        const selects = el.getElementsByTagName("select");
        nodes[id].text = inputs[0].value || "(Untitled)";
        nodes[id].type = selects[0].value;
      }
      document.getElementById("output").textContent = JSON.stringify(nodes, null, 2);
    }
  </script>

</body>

</html>
